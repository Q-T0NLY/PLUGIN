#!/usr/bin/env zsh
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                  ENHANCED QUANTUM HEADER v3.1 - BIG SUR                  â•‘
# â•‘         Optimized Real-Time System Metrics for Intel Macs                â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

quantum_header() {
    local cols=$(tput cols 2>/dev/null || echo 80)
    local start_time=$(date +%s%N)

    # Ultra-modern gradient palette (256-color) with optimized colors
    local palette=(51 45 39 33 27 21 57 63 99 105)  # Extended palette

    gradient_line() {
        local text="$1"
        local t=$(( $(date +%s) % ${#palette[@]} ))
        local color=${palette[$((t + 1))]}
        print -Pn "%F{${color}}${text}%f"
    }

    # Live telemetry for the header (lightweight)
    local cpu_usage=$(top -l 1 | grep "CPU usage" | awk '{print $3}' | sed 's/%//' 2>/dev/null || echo "0.0")
    local mem_total=$(sysctl -n hw.memsize 2>/dev/null | awk '{printf "%.2f", $1/1024/1024/1024}' || echo "0")
    local mem_stats=$(vm_stat 2>/dev/null | head -5)
    local mem_free_pages=$(echo "${mem_stats}" | grep "Pages free" | awk '{print $3}' | sed 's/\.//')
    local page_size=$(echo "${mem_stats}" | head -1 | awk '{print $8}')
    local mem_free_gb=$(awk "BEGIN {printf \"%.2f\", (${mem_free_pages} * ${page_size}) / 1024 / 1024 / 1024}")
    local mem_used_gb=$(awk "BEGIN {printf \"%.2f\", ${mem_total} - ${mem_free_gb}}")
    local mem_percent=$(awk "BEGIN {printf \"%.1f\", (${mem_used_gb} / ${mem_total}) * 100}")
    local disk_usage=$(df -h / 2>/dev/null | awk 'NR==2 {print $5}' | sed 's/%//' || echo "0")
    local uptime_seconds=$(sysctl -n kern.boottime 2>/dev/null | awk '{print $4}' | sed 's/,//' || echo "0")
    local current_time=$(date +%s)
    local uptime_days=$(awk "BEGIN {printf \"%.1f\", (${current_time} - ${uptime_seconds}) / 86400}")
    local gefs=$(awk "BEGIN {printf \"%.2f\", 100 - (${cpu_usage} * 0.3 + ${mem_percent} * 0.3 + ${disk_usage} * 0.2)}")
    local perf_ms=$(awk "BEGIN {printf \"%.2f\", 0.5 + (${cpu_usage} / 200)}")
    local risk=$(awk "BEGIN {printf \"%.3f\", (100 - ${gefs}) / 1000}")
    local health=$(awk "BEGIN {printf \"%.0f\", ${gefs}}")

    # Pad telemetry lines to fit inside the frame (content width 69 chars)
    local content_width=69
    local tele_line1=$(printf "%-69.69s" "$(printf "ğŸ¯ GEFS: %s%%    âš¡ MODE: HYPER-GENERATIVE    ğŸ“Š HEALTH: %s%%" "${gefs}" "${health}")")
    local tele_line2=$(printf "%-69.69s" "$(printf "ğŸ›¡ï¸ RISK: %s     ğŸš€ PERF: <%sms core         ğŸ”„ UPTIME: %sd" "${risk}" "${perf_ms}" "${uptime_days}")")

    local block=(
        "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        "â•‘                     ğŸš€ NEXUS AI STUDIO MATRIX v2.0 ğŸš€                        â•‘"
        "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        "â•‘  â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®    â•‘"
        "â•‘  â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â•‘    â•‘"
        "â•‘  â•‘  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘      â•‘    â•‘"
        "â•‘  â•‘  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•‘    â•‘"
        "â•‘  â•‘  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘      â•‘    â•‘"
        "â•‘  â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•‘    â•‘"
        "â•‘  â•‘    â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â• â•‘    â•‘"
        "â•‘  â•°â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¯    â•‘"
        "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        "â•‘  â”Œâ”€ LIVE TELEMETRY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘"
        "â•‘  â”‚ ${tele_line1} â”‚ â•‘"
        "â•‘  â”‚ ${tele_line2} â”‚ â•‘"
        "â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘"
        "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    )

    local block_width=${#block[1]}
    local pad=$(( (cols - block_width) / 2 ))
    [[ ${pad} -lt 0 ]] && pad=0

    local idx=1
    while [[ $idx -le ${#block[@]} ]]; do
        local line="${block[$idx]}"
        printf "%*s" ${pad} ""
        if [[ $idx -ge 5 && $idx -le 11 ]]; then
            gradient_line "${line}"
            echo ""
        else
            echo "${line}"
        fi
        ((idx++))
    done
}

# Particle field animation
quantum_particle_field() {
    local particles=("â—" "â—‹" "â—‰" "â—" "â—‘" "â—’" "â—“" "â–ª" "â–«" "â–´" "â–¾")
    local colors=({196..231})
    
    for i in {1..20}; do
        local particle=${particles[$((RANDOM % ${#particles[@]} + 1))]}
        local color=${colors[$((RANDOM % ${#colors[@]} + 1))]}
        print -Pn "%F{${color}}${particle}%f "
    done
    echo
}

# Singularity animation
quantum_singularity() {
    print -P "%F{51}    â•”â•â•â•â•â•â•â•â•—%f"
    print -P "%F{45}   â•‘   â—‰   â•‘%f"
    print -P "%F{39}  â•‘  â—‰â—‰â—‰  â•‘%f"
    print -P "%F{33} â•‘ â—‰â—‰â—‰â—‰â—‰ â•‘%f"
    print -P "%F{27}â•šâ•â•â•â•â•â•â•â•â•â•â•â•%f"
}

# Wormhole animation
quantum_wormhole() {
    print -P "%F{93}â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰%f"
    print -P "%F{129}â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰%f"
    print -P "%F{165}â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰%f"
    print -P "%F{201}â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰â—‰%f"
}

